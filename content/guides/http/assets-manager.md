AdonisJS makes use of [webpack encore](https://www.npmjs.com/package/@symfony/webpack-encore) to compile and serve the frontend assets. Webpack encore is a wrapper on top of [webpack](https://webpack.js.org/) to make it easier to work with the Webpack config.

:::note

AdonisJS is a backend framework and does not concern itself directly with the frontend build tools.

You are free to NOT use Webpack encore and set up the frontend build tools yourself and everything will still work.

:::

## Getting started

Creating a new AdonisJS application also prompts you to configure webpack encore. However, setting it up afterwards is also relatively simple. Just run the following ace command.

```sh
node ace configure encore
```

The following actions are performed to setup webpack encore:

- Install `‌@symfony/webpack-encore` npm package.
- Create a default `webpack.config.js` file.
- Create `resources/js/app.js` and `resources/css/app.css` files as the first entry point to your frontend application.

## Compiling frontend assets

Once encore has been configured, the pre-existing commands of AdonisJS will detect it and also process your frontend assets as part of the following commands.

---

#### node ace serve --watch

The `node ace serve --watch` command will also run the [webpack dev server](https://github.com/webpack/webpack-dev-server) within the same process to compile and serve the frontend assets.

![Log lines prefixed with "encore" are from the webpack-dev-server](https://res.cloudinary.com/adonis-js/image/upload/q_auto,f_auto/v1617015453/v5/encore-dev-server.png)

---

#### node ace build --production

Similarly, the `node ace build --production` command will also run the `encore production` command to bundle the frontend assets alongside your AdonisJS build.

![](https://res.cloudinary.com/adonis-js/image/upload/q_auto,f_auto/v1617030130/v5/node-ace-build-encore.png)

---

### Customizing output directory

By default, the compiled assets are written to the `./public/assets` directory so that AdonisJS static file server can serve them.

However, you can customize and define any output directory by updating the `webpack.config.js` file.

The `setOutputPath` method accepts a path relative to the project root. Also, make sure to update the  public URL prefix using the `setPublicPath` method.

```js
// Write file to this directory
Encore.setOutputPath('./public/assets')

// Prefix the following to the output URL
Encore.setOutputPath('/assets')
```

### Disable assets compilation

You can disable webpack assets compilation by passing the `--no-assets` flag to the `serve` and the `build` commands.

```sh
node ace serve --watch --no-assets
node ace build --productions --no-assets
```

## Assets view helpers

Depending upon your webpack config, the output files may not have the same as the input file. For example: The `Encore.enableVersioning()` method appends the file hash to the output file name.

Hence, it is recommended to never hardcode the file names in your templates and always use the `asset` helper.

#### ❌ Not recommended

```edge
<!DOCTYPE html>
<html lang="en">
<head>
    // highlight-start
  <script src="/assets/app.js"></script>
  <link rel="stylesheet" type="text/css" href="/assets/app.css">  
    // highlight-end
</head>
<body>
</body>
</html>
```

#### ✅ Instead use the `asset` helper

```edge
<!DOCTYPE html>
<html lang="en">
<head>
  // highlight-start
  <script src="{{ asset('assets/app.js') }}"></script>
  <link rel="stylesheet" type="text/css" href="{{ asset('assets/app.css') }}">  
    // highlight-end
</head>
<body>
</body>
</html>
```

The `asset` helper relies on the `manifest.json` file generated by encore to resolve the actual URL. You can use it for all the assets including JavaScript, CSS, fonts, images and so on.

## Manifest file

Encore generates the `manifest.json` file inside the `public/assets` directory. This file contains a key-value pair of the file identifier and its URL.

```json
{
  "assets/app.css": "http://localhost:8080/assets/app.css",
  "assets/app.js": "http://localhost:8080/assets/app.js"
}
```

The `asset` view helper resolves the URL from this file itself.

## Entrypoints

Every webpack bundle always have one or more [entrypoints](https://webpack.js.org/guides/code-splitting/#entry-points). Any other imports inside the entrypoint file are part of the same bundle. 

For example, if you have registered `./resources/js/app.js` file as an entrypoint with the following contents, then all the internal imports will be bundled together to form a single output.

```js
import '../css/app.css'
import 'normalize.css'
import 'alpinejs'
```

You can define these entrypoints inside the `webpack.config.js` file using the `Encore.addEntry` method. The first argument is the entrypoint name and 2nd is the path to the entrypoint file.

```js
Encore.addEntry('app', './resources/js/app.js')
```

### Multiple entry points

Most applications need a single entrypoint, unless you are building multiple interfaces in a single codebase. For example: Creating a public website + an admin panel may require different entrypoints as they will usually have different frontend dependencies and styling all together.

You can define multiple entrypoints by calling the `Encore.addEntry` method for the multiple times.

### Reference entrypoints inside the template files

You can make use of the `@entryPointStyles` and the `@entryPointScripts` tags to render the script and the style tags for a given entrypoint.

The tags will output the HTML with the correct `href` and `src` attributes. Also, the `./public/assets/entrypoints.json` file is used to lookup the URLs for a given entrypoint.

```edge
<!DOCTYPE html>
<html lang="en">
<head>
  @entryPointScripts('app')
  @entryPointStyles('app')
</head>
<body>
</body>
</html>
```

## Setup PostCSS

The first step is to install the [postcss-loader](https://github.com/postcss/postcss-loader) from the npm registry as follows:

```sh
npm i -D postcss-loader
```

Next, create the `postcss.config.js` file to configure PostCSS.

```js
// title: postcss.config.js
module.exports = {
  plugins: {}
}
```

And finally enable the PostCSS loader inside the `webpack.config.js` file.

```js
Encore.enablePostCssLoader()

// Pass options
Encore.enablePostCssLoader((options) => {
  options.postcssOptions = {
    config: path.resolve(__dirname, 'custom.config.js')
  }
})
```

## Setup SASS, Less and Stylus

To configure the CSS pre-processors, you must uncomment the following lines of code inside the `webpack.config.js`

```js
// Enables SASS
Encore.enableSassLoader()

// Enables Less
Encore.enableLessLoader()

// Enables Stylus
Encore.enableStylusLoader()
```

Also, make sure to install the appropriate loaders for them.

```sh
# For SASS
npm i -D sass-loader

# For Less
npm i -D less-loader

# For Stylus
npm i -D stylus-loader
```

## Copying & referencing images

## Configuring Babel

Babel is pre-configured for all files with `.js` and `.jsx` extensions using [babel-loader](https://github.com/babel/babel-loader).

You can further configure babel using the `Encore.configureBabel` method.

```js
// title: webpack.config.js
Encore.configureBabel((babelConfig) => {
  babelConfig.plugins.push('styled-jsx/babel')
  babelConfig.presets.push('@babel/preset-flow')
}, {
  exclude: /node_modules/
})
```

### Configuring browser targets

You can configure the browser targets for [@babel/preset-env](https://babeljs.io/docs/en/babel-preset-env) inside the `package.json`.

```json
{
  "browserslist": [
    "> 0.5%",
    "last 2 versions",
    "Firefox ESR",
    "not dead"
  ]
}
```

### Using the `.babelrc` file

Instead of calling `configureBabel()`, you can also make use of the standard `.babelrc` file. However, this approach has a downside: as soon as a `.babelrc` file is present, Encore can longer configure babel for you and `.babelrc` file becomes the single source of truth.


## Configuring React

You can configure React by installing react preset for babel from the npm registry.

```sh
npm i -D @babel/preset-react
```

Next, enable the react preset inside the `webpack.config.js` file.

:::warn

If you are using the `.babelrc` file, then you must enable the react preset inside it, as Encore can no longer configure babel.

:::

```js
Encore.enableReactPreset()
```

## Configuring Vue

## Adding custom webpack loaders
